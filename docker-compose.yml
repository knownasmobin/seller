services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: sell_bot_backend
    restart: unless-stopped
    # No public ports - only accessible internally via Docker network
    # Frontend proxies /api/ through nginx, bot uses http://backend:3000
    volumes:
      - backend_data:/app/data
    environment:
      - PORT=3000
      - DB_PATH=/app/data/sellbot.db
      - OXAPAY_MERCHANT_KEY=${OXAPAY_MERCHANT_KEY}
      - BOT_TOKEN=${BOT_TOKEN}
      - MARZBAN_URL=${MARZBAN_URL}
      - MARZBAN_USERNAME=${MARZBAN_USERNAME}
      - MARZBAN_PASSWORD=${MARZBAN_PASSWORD}
      - WGPORTAL_URL=${WGPORTAL_URL}
      - WGPORTAL_USERNAME=${WGPORTAL_USERNAME}
      - WGPORTAL_PASSWORD=${WGPORTAL_PASSWORD}
      - BOT_NAME=${BOT_NAME}
      - WIRESOCK_ALLOWED_APPS=${WIRESOCK_ALLOWED_APPS}
      - ADMIN_DASHBOARD_PASSWORD=${ADMIN_DASHBOARD_PASSWORD}
      - ADMIN_CARD_NUMBER=${ADMIN_CARD_NUMBER}

  bot:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: sell_bot_telegram
    restart: unless-stopped
    depends_on:
      - backend
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - ADMIN_ID=${ADMIN_ID}
      - ADMIN_CARD_NUMBER=${ADMIN_CARD_NUMBER}
      # Point to the backend service container instead of localhost
      - API_BASE_URL=http://backend:3000/api/v1

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "8085:80"
    depends_on:
      - backend

volumes:
  backend_data:
